{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "type": "object",
    "description": "A list of mappings from Puli paths to filesystem paths/other Puli paths.",
    "definitions": {
        "relativePath": {
            "description": "A relative file system path.",
            "type": "string",
            "pattern": "^([a-zA-Z][^:]|[^/@a-zA-Z])[^/]*(/[^/]+)*$"
        },
        "absolutePath": {
            "description": "An absolute file system path.",
            "type": "string",
            "pattern": "^([a-zA-Z]:)?/(([^/]+/)*[^/]+)?$"
        },
        "virtualResource": {
            "description": "A virtual resource in the Puli repository.",
            "type": "null"
        },
        "repositoryLink": {
            "description": "A link to another resource in the Puli repository.",
            "type": "string",
            "pattern": "^@/(([^/]+/)*[^/]+)?$"
        },
        "singleReference": {
            "description": "A reference to a single file, directory, link or virtual resource.",
            "oneOf": [
                { "$ref": "#/definitions/relativePath" },
                { "$ref": "#/definitions/absolutePath" },
                { "$ref": "#/definitions/virtualResource" },
                { "$ref": "#/definitions/repositoryLink" }
            ]
        },
        "combinedReference": {
            "description": "A list of references. The first reference has highest priority. Directories contents are merged.",
            "type": "array",
            "minItems": 2,
            "items": { "$ref": "#/definitions/singleReference" },
            "uniqueItems": true
        }
    },
    "properties": {
        "_order": {
            "type": "object",
            "patternProperties": {
                "^\\/(([^\\/]+\\/)*[^\\/]+)?$": {
                    "type": "array",
                    "minItems": 2,
                    "items": {
                        "description": "An entry of the order array",
                        "type": "object",
                        "properties": {
                            "path": {
                                "description": "One of the mapped paths in this file",
                                "type": "string",
                                "pattern": "^/(([^/]+/)*[^/]+)?$"
                            },
                            "references": {
                                "description": "The number of references to use at this slot of the order",
                                "type": "integer",
                                "min": 1
                            }
                        }
                    }
                }
            }
        }
    },
    "patternProperties": {
        "^\\/(([^\\/]+\\/)*[^\\/]+)?$": {
            "oneOf": [
                { "$ref": "#/definitions/singleReference" },
                { "$ref": "#/definitions/combinedReference" }
            ]
        }
    },
    "additionalProperties": false
}
